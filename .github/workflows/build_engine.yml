name: 1. Build Engine (Manual)

on:
  workflow_dispatch: # Nur manuell startbar!

permissions:
  contents: write

jobs:
  build-engine:
    runs-on: windows-latest
    
    steps:
    - name: Checkout Repo (f√ºr Dateistruktur)
      uses: actions/checkout@v3

    - name: üêç Python Embeddable laden
      run: |
        curl -L -o python.zip https://www.python.org/ftp/python/3.10.11/python-3.10.11-embed-amd64.zip
        mkdir Engine
        tar -xf python.zip -C Engine
        del python.zip

    - name: üîß Pip installieren
      working-directory: Engine
      run: |
        curl -L -o get-pip.py https://bootstrap.pypa.io/get-pip.py
        .\python.exe get-pip.py --no-warn-script-location
        echo import site>> python310._pth
        del get-pip.py

    - name: üì¶ Schwere Bibliotheken installieren (PyTorch & Co)
      working-directory: Engine
      run: |
        echo Installiere PyTorch (GPU)...
        .\python.exe -m pip install torch torchvision torchaudio --index-url https://download.pytorch.org/whl/cu121
        
        echo Installiere Requirements...
        .\python.exe -m pip install numpy==1.26.4
        .\python.exe -m pip install TTS easyocr pyaudio keyboard pyautogui opencv-python pillow soundfile

        echo Bereinige Cache...
        .\python.exe -m pip cache purge

    - name: ü§ê Engine Zippen
      run: |
        powershell Compress-Archive -Path "Engine" -DestinationPath "LQAG_Engine_v1.zip"

    - name: üöÄ Release erstellen und Upload
      uses: softprops/action-gh-release@v1
      with:
        tag_name: Engine-v1.0
        name: "LQAG Engine Base (Nur einmal laden!)"
        draft: false
        prerelease: false
        files: LQAG_Engine_v1.zip
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
